---
import { options, posts } from '@/content/schema';
import { searchPosts } from '@/content/search';
import SearchLayout from '@/layouts/posts/SearchLayout.astro';

const query = Astro.url.searchParams.get('q') || '';
if (query === '') {
  return Astro.redirect('/');
}

const title = `${query} 查询结果`;
const searchResults = searchPosts(query)
  .map((slug) => posts.find((post) => post.slug === slug))
  .flatMap((post) => (post == null ? [] : [post]))
  .slice(0, options.settings.pagination.search);
export const prerender = false;
---

<SearchLayout {title} posts={searchResults} />
